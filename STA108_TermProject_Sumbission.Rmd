---
title: "STA108 Term Project"
author: "Gabriel Jones"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
# Libraries

suppressPackageStartupMessages({
library(readr)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(knitr)
library(plotrix)
library(ggpubr)
library(MASS)
library(lindia)
library(car)
library(tidyr)
})  
```

```{r}
# Load Data
countries <- read.csv("countries.csv")
countries <- janitor::clean_names(countries)

# Select Subset
n <- nrow(countries)
set.seed(39) # HATSUNE MIKU
subset_id <- sample(n, 0.8*n)
countries <- countries[subset_id, ]

# Transformations
countries_new <- countries %>%
  mutate(co2=log(co2))%>%
  mutate(elderly_pop=log(elderly_pop))%>% 
  mutate(gdp=log(gdp))%>%
  mutate(internet=log(internet))
```

All files related to this project can be accessed via https://github.com/gqjones/STA108_TermProject 

## Introduction

In this project, we are interested in building a parsimonious model to estimate the life expectancy of individuals depending on various aspects of their residence country. The factors that will be considered for this model include: *Land Area*, *Population*, *Rural Population*, *Health Care Expenditures*, *Internet Access*, *Birth Rate*, *Elderly Population*, *CO2 Emissions*, *GDP*, and *Cell Phone Subscriptions*. The data set provided contains this information for 148 different countries. 

## Methods

We began our analysis by fitting single factor linear models with each of our potential predictors on life expectancy using the `lm()` function in R. This provided us with estimates for the regression parameter, $R^2$ values, and t-test results to test if the predictor may not have any relationship with life expectancy. From this information, we found that the predictors *Land Area* and *Population* had no significant affect on Life Expectancy, thus they were no longer considered as predictors in our model. 

We then plotted the relationships between our predictor and outcome variables and carried out a residual analysis for each model to determine any deviations from standard linear regression model assumptions. From this, we found that *CO2*, *Elderly Population*, *GDP*, and *Internet* had abnormal residual plots and non-linearity with life expectancy. To remedy this, we took the natural logarithm of each of these predictors. For the most part, this resolved the issues with these models with the exception of *Elderly Population* barely exhibiting any change from its previous diagnostics. Below shows the change in residual plots after the transformation. This same change was exhibited in *CO2* and *Internet*.

```{r fig.height=3.5, fig.width=7.4}
gdp_lm <- lm(life_expectancy ~ gdp, data=countries)
gdp_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(gdp_lm), #<change>
             y=residuals(gdp_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="GDP Residuals Plot",
       x="Fitted Values",
       y="Residuals")

gdp_lm_new <- lm(life_expectancy ~ gdp, data=countries_new)
gdp_new_resid <- countries_new%>%  #<change>
  ggplot(aes(x=fitted(gdp_lm_new), #<change>
             y=residuals(gdp_lm_new) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="log(GDP) Residuals Plot",
       x="Fitted Values",
       y="Residuals")
suppressMessages({
  ggarrange(gdp_resid, gdp_new_resid)
})
```

Additionally, we noticed that the residual plots for all the single factor linear models exhibited heteroscedasticity. This suggested that there may be an issue with our response variable *Life Expectancy*. After creating a QQ plot for life expectancy, we saw that the data was left skewed. As an attempt to remedy this, we performed a boxcox transformation on *Life Expectancy* using $\lambda = 2$, but found that there was minimal change in the normality of the data. After performing a Shapiro-Wilk normality test to ensure there was no change in normality, we decided not to use the boxcox transformed response variable. The graphs below show the lack of change in normality.

```{r fig.height=3.5, fig.width=7.4}
respqq <- ggplot(data=countries, aes(sample=life_expectancy))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title="Response QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")

countries_t <- countries
countries_t$life_expectancy <- (countries$life_expectancy^2-1)/2
transqq <- ggplot(data=countries_t, aes(sample=life_expectancy))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title="Transformed Response QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
rm(countries_t)

suppressMessages({
  ggarrange(respqq, transqq)
})
```

Before moving on to variable selection and building of our multifactor model, we assessed the potential for multicollinearity in each pair of our variables. We did this by finding the VIF values for each pair of variables, then displaying them together as a matrix.

```{r}
names <- c("LandArea", "Population", "Rural", "Health", "Internet", "BirthRate",
           "ElderlyPop", "CO2", "GDP", "Cell")

suppressWarnings({datmat <- countries_new%>%
  select_("-country", "-code", "-life_expectancy")
})

datmat <- as.matrix.data.frame(datmat)
outmat <- matrix(data=10, nrow=10,ncol=10)

for (i in 1:10){
  for (j in 1:10){
    # Check for same column
    if (i == j){
      next
    }
    
    # Make Linear models
    model <- lm(life_expectancy ~ datmat[,i] + datmat[,j], data=countries_new)
    vifvals <- vif(model)
    outmat[i,j] = round(vifvals[1], 3)
    outmat[j,i] = round(vifvals[1], 3) 
    rm(model)
    rm(vifvals)
  }
}

rownames(outmat) <- names
colnames(outmat) <- names

kable(outmat, caption = "VIF Values")
```

From the above table, we can see that *CO2* and *GDP* have the most collinearity with each other. These two variables also exhibit VIF values over 2 for other variables as well. As such, we determined it may be beneficial to exclude these variables from our model. 

To select variables for our model, we used both forward selection and backward elimination algorithms provided by the `LEAPS` package. We ran the two algorithms on the model excluding *Land Area* and *Population* and the natural log transformations of *CO2*, *Elderly Population*, *GDP*, and *Internet*. Both algorithms came to the same result, so we used the specified variables in our final model. 

## Results

From our analysis, the variables we found to be most accurate in predicting life expectancy were: *Rural Population*, *Health*, *Internet*, *Birth Rate*, and *Elderly Population*. We found that the variables *Internet* and *Elderly Population* exhibited a logistic relationship with life expectancy, while the other three variables exhibited a linear relationship. The final model had $R^2 = 0.785$. The *elderly population*, *birth rate*, and *% rural population* were shown to have a negative relationship with life expectancy, thus, minimizing these factors would work to maximize life expectancy. Below details our model found to best predict life expectancy along with explicit definitions for each predictor.

$X_1=$ % Rural Population

$X_2=$ % of $ For Healthcare

$X_3=$ % of Population With Internet Access

$X_4=$ Birth Rate per 1000 Individuals

$X_5=$ % Elderly Population

$$
LifeExpectancy = \beta_0 + \beta_{1}X_{1} + \beta_{2}X_{2} + \beta_{3}log(X_{3}) +  \beta_{4}X_{4} + \beta_{5}log(X_{5}) + \epsilon
$$

Below details our estimates for $\beta_1,...,\beta_5$ 

```{r}
best_lm <- lm(life_expectancy ~ rural + health + internet + 
                birth_rate + elderly_pop, data=countries_new)

best_lm_summary <- summary(best_lm)
output <- data.frame(
  "Beta"=c("b0", "b1", "b2", "b3", "b4", "b5"),
  "Estimate"= best_lm_summary$coefficients[,1]
  )
output <- output%>%
  pivot_wider(names_from="Beta", values_from="Estimate")%>%
  as.data.frame(.)
rownames(output) <- "Estimate"

kable(output)
```

## Summary

The goal of this project was to build a parsimonious model that estimates the life expectancy of an individual based on data from the country they live in. After carrying out residual analysis, variable transformations, and variable selection algorithms, we found the best variables used in predicting life expectancy were *Rural Population*, *Health*, *Internet*, *Birth Rate*, and *Elderly Population*. Our model does an adequate job at estimating life expectancy, however, there are some improvements that can increase the effectiveness of this model. One improvement would be to use a more effective transformation of the *Elderly Population* variable to resolve the non constant error. This model could also be improved by resolving the Heteroscedasticity of the residuals in our model. 

\newpage

## Appendix

```{r}
# Libraries

suppressPackageStartupMessages({
library(readr)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(knitr)
library(plotrix)
library(ggpubr)
library(MASS)
library(lindia)
library(leaps)
library(car)
})  
```

```{r}
# Load Data
countries <- read.csv("countries.csv")
countries <- janitor::clean_names(countries)

# Select Subset
n <- nrow(countries)
set.seed(39) # HATSUNE MIKU
subset_id <- sample(n, 0.8*n)
countries <- countries[subset_id, ] 
```

## Single Linear Regression Models & Analysis

**Life Expectancy Analysis**

```{r}
# Life Expectancy QQ Plot
ggplot(data=countries, aes(sample=life_expectancy))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title="Response QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
```

**Life Expectancy \~ Land Area**

```{r}
# Variable Names
x.lab <- "Land Area" #<change>
x.dat <- countries$land_area #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
landarea_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
landarea_lm_summary <- summary(landarea_lm) #<change>
row.names(landarea_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(landarea_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
landarea_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
landarea_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(landarea_lm), #<change>
             y=residuals(landarea_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
landarea_ResidQQ <- landarea_lm%>% #<change>
  ggplot(aes(sample=residuals(landarea_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
landarea_QQ <- landarea_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(landarea_scatter, landarea_resid) #<change>
ggarrange(landarea_QQ, landarea_ResidQQ) #<change>
```

**Life Expectancy \~ Birth Rate**

```{r}
# Variable Names
x.lab <- "Birth Rate" #<change>
x.dat <- countries$birth_rate #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
birthrate_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
birthrate_lm_summary <- summary(birthrate_lm) #<change>
row.names(birthrate_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(birthrate_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
birthrate_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
birthrate_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(birthrate_lm), #<change>
             y=residuals(birthrate_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
birthrate_ResidQQ <- birthrate_lm%>% #<change>
  ggplot(aes(sample=residuals(birthrate_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
birthrate_QQ <- birthrate_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(birthrate_scatter, birthrate_resid) #<change>
ggarrange(birthrate_QQ, birthrate_ResidQQ) #<change>
```

**Life Expectancy \~ Cell**

```{r}
# Variable Names
x.lab <- "Cell" #<change>
x.dat <- countries$cell #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
cell_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
cell_lm_summary <- summary(cell_lm) #<change>
row.names(cell_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(cell_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
cell_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
cell_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(cell_lm), #<change>
             y=residuals(cell_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
cell_ResidQQ <- cell_lm%>% #<change>
  ggplot(aes(sample=residuals(cell_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
cell_QQ <- cell_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(cell_scatter, cell_resid) #<change>
ggarrange(cell_QQ, cell_ResidQQ) #<change>
```

**Life Expectancy \~ CO2**

```{r}
# Variable Names
x.lab <- "CO2" #<change>
x.dat <- countries$co2 #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
co_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
co_lm_summary <- summary(co_lm) #<change>
row.names(co_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(co_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
co_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
co_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(co_lm), #<change>
             y=residuals(co_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
co_ResidQQ <- co_lm%>% #<change>
  ggplot(aes(sample=residuals(co_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
co_QQ <- co_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(co_scatter, co_resid) #<change>
ggarrange(co_QQ, co_ResidQQ) #<change>
```

**Life Expectancy \~ Elderly Population**

```{r}
# Variable Names
x.lab <- "Elderly Population" #<change>
x.dat <- countries$elderly_pop #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
elder_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
elder_lm_summary <- summary(elder_lm) #<change>
row.names(elder_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(elder_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
elder_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
elder_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(elder_lm), #<change>
             y=residuals(elder_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
elder_ResidQQ <- elder_lm%>% #<change>
  ggplot(aes(sample=residuals(elder_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
elder_QQ <- elder_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(elder_scatter, elder_resid) #<change>
ggarrange(elder_QQ, elder_ResidQQ) #<change>
```

**Life Expectancy \~ GDP**

```{r}
# Variable Names
x.lab <- "GDP" #<change>
x.dat <- countries$gdp #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
gdp_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
gdp_lm_summary <- summary(gdp_lm) #<change>
row.names(gdp_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(gdp_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
gdp_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
gdp_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(gdp_lm), #<change>
             y=residuals(gdp_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
gdp_ResidQQ <- gdp_lm%>% #<change>
  ggplot(aes(sample=residuals(gdp_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
gdp_QQ <- gdp_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(gdp_scatter, gdp_resid) #<change>
ggarrange(gdp_QQ, gdp_ResidQQ) #<change>
```

**Life Expectancy \~ Health**

```{r}
# Variable Names
x.lab <- "Health" #<change>
x.dat <- countries$health #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
health_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
health_lm_summary <- summary(health_lm) #<change>
row.names(health_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(health_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
health_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
health_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(health_lm), #<change>
             y=residuals(health_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
health_ResidQQ <- health_lm%>% #<change>
  ggplot(aes(sample=residuals(health_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
health_QQ <- health_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(health_scatter, health_resid) #<change>
ggarrange(health_QQ, health_ResidQQ) #<change>
```

**Life Expectancy \~ Internet**

```{r}
# Variable Names
x.lab <- "Internet" #<change>
x.dat <- countries$internet #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
internet_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
internet_lm_summary <- summary(internet_lm) #<change>
row.names(internet_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(internet_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
internet_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
internet_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(internet_lm), #<change>
             y=residuals(internet_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
internet_ResidQQ <- internet_lm%>% #<change>
  ggplot(aes(sample=residuals(internet_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
internet_QQ <- internet_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(internet_scatter, internet_resid) #<change>
ggarrange(internet_QQ, internet_ResidQQ) #<change>
```

**Life Expectancy \~ Population**

```{r}
# Variable Names
x.lab <- "Population" #<change>
x.dat <- countries$population #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
population_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
population_lm_summary <- summary(population_lm) #<change>
row.names(population_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(population_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
population_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
population_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(population_lm), #<change>
             y=residuals(population_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
population_ResidQQ <- population_lm%>% #<change>
  ggplot(aes(sample=residuals(population_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
population_QQ <- population_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(population_scatter, population_resid) #<change>
ggarrange(population_QQ, population_ResidQQ) #<change>
```

**Life Expectancy \~ Rural**
  
```{r}
# Variable Names
x.lab <- "Rural" #<change>
x.dat <- countries$rural #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
rural_lm <- lm(life_expectancy ~ x.dat, data=countries) #<change>
rural_lm_summary <- summary(rural_lm) #<change>
row.names(rural_lm_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(rural_lm_summary$coefficients, #<change>
      caption=title)


# Scatterplot
rural_scatter <- countries%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual Plot
rural_resid <- countries%>%  #<change>
  ggplot(aes(x=fitted(rural_lm), #<change>
             y=residuals(rural_lm) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Residual QQ Plot
rural_ResidQQ <- rural_lm%>% #<change>
  ggplot(aes(sample=residuals(rural_lm)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste("Residual QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


# Predictor QQ Plot
rural_QQ <- rural_lm%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path=paste0("../Plots/", x.lab))


ggarrange(rural_scatter, rural_resid) #<change>
ggarrange(rural_QQ, rural_ResidQQ) #<change>
```

## Transformations

```{r}
# Transformations
countries_new <- countries %>%
  mutate(co2=log(co2))%>%
  mutate(elderly_pop=log(elderly_pop))%>% 
  mutate(gdp=log(gdp))%>%
  mutate(internet=log(internet))
```

## New Models

**Life Expectancy \~ log(CO2)**

```{r}
# Variable Names
x.lab <- "log(CO2)" #<change>
x.dat <- countries_new$co2 #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
co_lm_new <- lm(life_expectancy ~ x.dat, data=countries_new) #<change>
co_lm_new_summary <- summary(co_lm_new) #<change>
row.names(co_lm_new_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(co_lm_new_summary$coefficients, #<change>
      caption=title)


# Scatterplot
co_scatter <- countries_new%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path="../Plots/CO2")


# Residual Plot
co_resid <- countries_new%>%  #<change>
  ggplot(aes(x=fitted(co_lm_new), #<change>
             y=residuals(co_lm_new) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path="../Plots/CO2")


# Residual QQ Plot
co_ResidQQ <- co_lm_new%>% #<change>
  ggplot(aes(sample=residuals(co_lm_new)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "Residual QQ Plot.png"), device = "png", path="../Plots/CO2")


# Predictor QQ Plot
co_QQ <- co_lm_new%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path="../Plots/CO2")


ggarrange(co_scatter, co_resid) #<change>
ggarrange(co_QQ, co_ResidQQ) #<change>
```

**Life Expectancy \~ log(Elderly Population)**

```{r}
# Variable Names
x.lab <- "log(Elderly Population)" #<change>
x.dat <- countries_new$elderly_pop #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
elder_lm_new <- lm(life_expectancy ~ x.dat, data=countries_new) #<change>
elder_lm_new_summary <- summary(elder_lm_new) #<change>
row.names(elder_lm_new_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(elder_lm_new_summary$coefficients, #<change>
      caption=title)


# Scatterplot
elder_scatter <- countries_new%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path="../Plots/Elderly Population")


# Residual Plot
elder_resid <- countries_new%>%  #<change>
  ggplot(aes(x=fitted(elder_lm_new), #<change>
             y=residuals(elder_lm_new) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path="../Plots/Elderly Population")


# Residual QQ Plot
elder_ResidQQ <- elder_lm_new%>% #<change>
  ggplot(aes(sample=residuals(elder_lm_new)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "Residual QQ Plot.png"), device = "png", path="../Plots/Elderly Population")


# Predictor QQ Plot
elder_QQ <- elder_lm_new%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path="../Plots/Elderly Population")


ggarrange(elder_scatter, elder_resid) #<change>
ggarrange(elder_QQ, elder_ResidQQ) #<change>
```

**Life Expectancy \~ log(GDP)**

```{r}
# Variable Names
x.lab <- "log(GDP)" #<change>
x.dat <- countries_new$gdp #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
gdp_lm_new <- lm(life_expectancy ~ x.dat, data=countries_new) #<change>
gdp_lm_new_summary <- summary(gdp_lm_new) #<change>
row.names(gdp_lm_new_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(gdp_lm_new_summary$coefficients, #<change>
      caption=title)


# Scatterplot
gdp_scatter <- countries_new%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path="../Plots/GDP")


# Residual Plot
gdp_resid <- countries_new%>%  #<change>
  ggplot(aes(x=fitted(gdp_lm_new), #<change>
             y=residuals(gdp_lm_new) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path="../Plots/GDP")


# Residual QQ Plot
gdp_ResidQQ <- gdp_lm_new%>% #<change>
  ggplot(aes(sample=residuals(gdp_lm_new)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "Residual QQ Plot.png"), device = "png", path="../Plots/GDP")


# Predictor QQ Plot
gdp_QQ <- gdp_lm_new%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path="../Plots/GDP")


ggarrange(gdp_scatter, gdp_resid) #<change>
ggarrange(gdp_QQ, gdp_ResidQQ) #<change>
```

**Life Expectancy \~ log(Internet)**

```{r}
# Variable Names
x.lab <- "log(Internet)" #<change>
x.dat <- countries_new$internet #<change>

y.lab <- "Life Expectancy"
title <- paste(y.lab, "~", x.lab)

  
# Create Linear Model
internet_lm_new <- lm(life_expectancy ~ x.dat, data=countries_new) #<change>
internet_lm_new_summary <- summary(internet_lm_new) #<change>
row.names(internet_lm_new_summary$coefficients) <- c("(Intercept)", x.lab) #<change>


# Display Values
kable(internet_lm_new_summary$coefficients, #<change>
      caption=title)


# Scatterplot
internet_scatter <- countries_new%>% #<change>
  ggplot(aes(y=life_expectancy, 
             x=x.dat))+
  geom_point(color='cyan4')+
  geom_smooth(method='lm', color="black")+
  labs(title=title,
       x=x.lab,
       y=y.lab)
ggsave(filename=paste(x.lab, "Scatterplot.png"), device = "png", path="../Plots/Internet")


# Residual Plot
internet_resid <- countries_new%>%  #<change>
  ggplot(aes(x=fitted(internet_lm_new), #<change>
             y=residuals(internet_lm_new) #<change>
             ))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Residuals Against Fitted Values",
       x="Fitted Values",
       y="Residuals")
ggsave(filename=paste(x.lab, "Residual Plot.png"), device = "png", path="../Plots/Internet")


# Residual QQ Plot
internet_ResidQQ <- internet_lm_new%>% #<change>
  ggplot(aes(sample=residuals(internet_lm_new)))+ #<change>
  geom_qq(color="brown3", size=1.3)+
  geom_qq_line()+
  labs(title="Residual QQ Plot",
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "Residual QQ Plot.png"), device = "png", path="../Plots/Internet")


# Predictor QQ Plot
internet_QQ <- internet_lm_new%>% #<change>
  ggplot(aes(sample=x.dat))+
  geom_qq(color="forestgreen", size=1.3)+
  geom_qq_line()+
  labs(title=paste(x.lab, "QQ Plot"),
       x="Theoretical Quantiles",
       y="Sample Quantiles")
ggsave(filename=paste(x.lab, "QQ Plot.png"), device = "png", path="../Plots/Internet")


ggarrange(internet_scatter, internet_resid) #<change>
ggarrange(internet_QQ, internet_ResidQQ) #<change>
```

**State All Rsq**

```{r}
kable(data.frame(
  "XVar"=c("Birth Rate", "Cell", "CO2", "Elderly Population", "GDP", "Health",
           "Internet", "Land Area", "Population", "Rural"),
  "Rsq"=c(birthrate_lm_summary$r.squared, cell_lm_summary$r.squared, 
          co_lm_summary$r.squared, elder_lm_summary$r.squared, gdp_lm_summary$r.squared,
          health_lm_summary$r.squared, internet_lm_summary$r.squared, landarea_lm_summary$r.squared,
          population_lm_summary$r.squared, rural_lm_summary$r.squared),
  
  "Adj.Rsq"=c(birthrate_lm_summary$adj.r.squared, cell_lm_summary$adj.r.squared, 
          co_lm_summary$adj.r.squared, elder_lm_summary$adj.r.squared, gdp_lm_summary$adj.r.squared,
          health_lm_summary$adj.r.squared, internet_lm_summary$adj.r.squared, landarea_lm_summary$adj.r.squared,
          population_lm_summary$adj.r.squared, rural_lm_summary$adj.r.squared),
  
  "Trans.Rsq"=c(NA, NA, co_lm_new_summary$r.squared, elder_lm_new_summary$r.squared, gdp_lm_new_summary$r.squared,
          NA, internet_lm_new_summary$r.squared, NA, NA, NA)
), caption="R Squared Values")
```

## Multifactor Models

```{r}
## Forward Selection

# Make Full Linear Model
full_model <- lm(life_expectancy ~ population + rural + health + 
                   internet + birth_rate + elderly_pop + co2 + gdp + cell, data=countries_new)

# Perform Forward Selection
forward_selection <- regsubsets(life_expectancy ~ population + rural + 
                                  health + internet + birth_rate + elderly_pop + 
                                  co2 + gdp + cell, data=countries_new, nbest=1, 
                                method = "forward")

summary_forward_selection <- summary(forward_selection)

# Find Best number of predictors
num_pred <- which.max(summary_forward_selection$adjr2)

# State which predictors to use
forward_predictors <- as.data.frame(summary_forward_selection$which[num_pred,])
forward_predictors <- rename(forward_predictors, "Include" = "summary_forward_selection$which[num_pred, ]")
kable(forward_predictors, caption="Forward Selection Predictiors")

# State Selection Process
kable(as.data.frame(summary_forward_selection$outmat), caption = paste0("Forward Selection Algorithm | nbest=", num_pred))


## Backward Elimination

# Make Full Linear Model
full_model <- lm(life_expectancy ~ population + rural + health + 
                   internet + birth_rate + elderly_pop + co2 + gdp + cell, data=countries_new)

# Perform Backward Selection
backward_elimination <- regsubsets(life_expectancy ~ population + rural + 
                                  health + internet + birth_rate + elderly_pop + 
                                  co2 + gdp + cell, data=countries_new, nbest=1, 
                                method = "backward")

summary_backward_elimination <- summary(backward_elimination)

# Find Best number of predictors
num_pred <- which.max(summary_backward_elimination$adjr2)

# State which predictors to use
backward_predictors <- as.data.frame(summary_backward_elimination$which[num_pred,])
backward_predictors <- rename(backward_predictors, "Include" = "summary_backward_elimination$which[num_pred, ]")
kable(backward_predictors, caption="Backward Elimination Predictiors")

# State Selection Process
kable(as.data.frame(summary_backward_elimination$outmat), caption = paste0("Backward Elimination Algorithm | nbest=", num_pred))
```

## Assess Multicollinearity

```{r}
names <- c("LandArea", "Population", "Rural", "Health", "Internet", "BirthRate",
           "ElderlyPop", "CO2", "GDP", "Cell")

datmat <- countries_new%>%
  select_("-country", "-code", "-life_expectancy")

datmat <- as.matrix.data.frame(datmat)
outmat <- matrix(data=Inf, nrow=10,ncol=10)

for (i in 1:10){
  for (j in 1:10){
    # Check for same column
    if (i == j){
      next
    }
    
    # Make Linear models
    model <- lm(life_expectancy ~ datmat[,i] + datmat[,j], data=countries_new)
    vifvals <- vif(model)
    outmat[i,j] = round(vifvals[1], 3)
    outmat[j,i] = round(vifvals[1], 3) 
    rm(model)
    rm(vifvals)
  }
}

rownames(outmat) <- names
colnames(outmat) <- names

kable(outmat, caption = "VIF Values")
```


## Best Model

```{r}
best_lm <- lm(life_expectancy ~ rural + health + internet + 
                birth_rate + elderly_pop, data=countries_new)

best_lm_summary <- summary(best_lm)
coefs <- cbind(best_lm_summary$coefficients, data.frame("RSq"=c(best_lm_summary$r.squared, rep(NA, 5))))
kable(coefs, caption="Best Model Summary")
```

```{r}
best_lm%>%
  ggplot(aes(x=fitted(best_lm), y=residuals(best_lm)))+
  geom_point(color="darkgoldenrod", shape=21)+
  geom_hline(yintercept=0)+
  labs(title="Best Model Residual Plot",
       x="Fitted Values",
       y="Residuals")
```